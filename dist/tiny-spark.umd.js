(function(R,x){typeof exports=="object"&&typeof module<"u"?x(exports):typeof define=="function"&&define.amd?define(["exports"],x):(R=typeof globalThis<"u"?globalThis:R||self,x(R.TinySpark={}))})(this,function(R){"use strict";const x="http://www.w3.org/2000/svg";var j=(t=>(t.BAR="bar",t.LINE="line",t))(j||{}),c=(t=>(t.ANIMATION="animation",t.AREA_COLOR="areaColor",t.CURVE="curve",t.DATES="dates",t.ID="id",t.INDICATOR_COLOR="indicatorColor",t.INDICATOR_WIDTH="indicatorWidth",t.LINE_COLOR="lineColor",t.LINE_THICKNESS="lineThickness",t.NUMBER_LOCALE="numberLocale",t.NUMBER_ROUNDING="numberRounding",t.NUMBER_SHOW_ON="numberShowOn",t.PLOT_COLOR="plotColor",t.PLOT_RADIUS="plotRadius",t.SET="set",t.HIDE_PLOTS_ABOVE="hidePlotsAbove",t.SHOW_LAST_VALUE="showLastValue",t.LAST_VALUE_FONT_SIZE="lastValueFontSize",t.LAST_VALUE_COLOR="lastValueColor",t.TYPE="type",t.TOOLTIP_SMOOTHING="tooltipSmoothing",t))(c||{}),z=(t=>(t.ANIMATION="data-animation",t.AREA_COLOR="data-area-color",t.CURVE="data-curve",t.DATES="data-dates",t.ID="data-id",t.INDICATOR_COLOR="data-indicator-color",t.INDICATOR_WIDTH="data-indicator-width",t.LINE_COLOR="data-line-color",t.LINE_THICKNESS="data-line-thickness",t.NUMBER_LOCALE="data-number-locale",t.NUMBER_ROUNDING="data-number-rounding",t.NUMBER_SHOW_ON="data-number-show-on",t.PLOT_COLOR="data-plot-color",t.PLOT_RADIUS="data-plot-radius",t.SET="data-set",t.HIDE_PLOTS_ABOVE="data-hide-plots-above",t.SHOW_LAST_VALUE="data-show-last-value",t.LAST_VALUE_FONT_SIZE="data-last-value-font-size",t.LAST_VALUE_COLOR="data-last-value-color",t.TYPE="data-type",t.TOOLTIP_SMOOTHING="data-tooltip-smoothing",t))(z||{});const ot={version:"0.6.1"};function rt(t){const{width:i,height:n}=t.parentElement.getBoundingClientRect(),s={width:300,height:100},a=String(u(t,c.SHOW_LAST_VALUE,"false"))==="true",e=E(t),h=e&&e.length?e.at(-1):null;let o=0;if(!(t.dataset.type&&t.dataset.type==="bar")&&a&&![null,void 0].includes(h)){const S=Number(String(u(t,c.NUMBER_ROUNDING,0)));o=6+h.toFixed(S).length*(Number(u(t,c.LAST_VALUE_FONT_SIZE,12))/2)}const L=`0 0 ${(i||s.width)+o} ${n||s.height}`,N=document.createElementNS(x,"svg"),b=t.dataset.id;N.id=b,N.setAttribute("viewBox",L),N.style.width="100%",N.style.height="100%";const _=document.createElementNS(x,"desc");return _.setAttribute("aria-hidden","true"),_.innerHTML=`Composed with tiny-spark v${ot.version}`,N.appendChild(_),{svg:N,svgId:b,width:i||s.width,height:n||s.height,viewBox:L}}function I(t,i=0){return isNaN(t)?i:t}function D(t){let i=[];for(let n=0;n<t.length;n+=1)i.push(`${I(t[n].x)},${I(t[n].y)} `);return i.join(" ").trim()}function K(t){if(t.length<1)return"0,0";const i=t.length-1,n=[`${I(t[0].x)},${I(t[0].y)}`],s=[],a=[],e=[],h=[];for(let o=0;o<i;o+=1)s[o]=t[o+1].x-t[o].x,a[o]=t[o+1].y-t[o].y,e[o]=a[o]/s[o];h[0]=e[0],h[i]=e[i-1];for(let o=1;o<i;o+=1)if(e[o-1]*e[o]<=0)h[o]=0;else{const O=2*e[o-1]*e[o]/(e[o-1]+e[o]);h[o]=O}for(let o=0;o<i;o+=1){const O=t[o].x,w=t[o].y,L=t[o+1].x,N=t[o+1].y,b=h[o],_=h[o+1],S=O+(L-O)/3,l=w+b*(L-O)/3,v=L-(L-O)/3,k=N-_*(L-O)/3;n.push(`C ${I(S)},${I(l)} ${I(v)},${I(k)} ${I(L)},${I(N)}`)}return n.join(" ")}function st(t,i=1e3,n){t.style.opacity="1";const s=t.getTotalLength();t.style.strokeDasharray=String(s),t.style.strokeDashoffset=String(s),t.getBoundingClientRect(),t.style.transition=`stroke-dashoffset ${i}ms ease-in-out`,t.style.strokeDashoffset="0",t.addEventListener("transitionend",function a(){t.style.transition="",t.removeEventListener("transitionend",a),n&&n()})}function at(t,i,n=1e3){i.style.opacity="1";const s=i.getBBox(),a=s.width,e=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),h="clip-"+Math.random().toString(36).substr(2,9);e.setAttribute("id",h);const o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x",s.x.toString()),o.setAttribute("y",s.y.toString()),o.setAttribute("width","0"),o.setAttribute("height",s.height.toString()),e.appendChild(o);let O=t.querySelector("defs");O||(O=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(O,t.firstChild)),O.appendChild(e),i.setAttribute("clip-path",`url(#${h})`),o.style.transition=`width ${n}ms ease-out`,o.getBoundingClientRect(),o.setAttribute("width",a.toString()),o.addEventListener("transitionend",function w(){i.removeAttribute("clip-path"),e.parentNode&&e.parentNode.removeChild(e),o.removeEventListener("transitionend",w)})}function lt(){return document.querySelectorAll(".tiny-spark")}function Z(t,i){return Object.keys(t.dataset).includes(i)}function u(t,i,n){return Z(t,i)?t.dataset[i]:n}function dt(t){if(!t)return{color:"#1A1A1A",backgroundColor:"#FFFFFF"};const i=window.getComputedStyle(t),n=i.getPropertyValue("color")||"#1A1A1A",s=i.getPropertyValue("background-color"),a=i.getPropertyValue("background");return{color:n,backgroundColor:s||a||"#FFFFFF"}}function q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=Math.random()*16|0;return(t=="x"?i:i&3|8).toString(16)})}function E(t){const i=t.getAttribute("data-set");if(!i)return[];try{const n=JSON.parse(i);return Array.isArray(n)&&n.every(s=>typeof s=="number"||[null,void 0].includes(s))?n:(console.warn("data-set is not an array of numbers."),[])}catch(n){return console.error("Error parsing data-set:",n),[]}}function ut(t){const i=t.getAttribute("data-dates");if(!i)return[];try{const n=JSON.parse(i);return Array.isArray(n)&&n.every(s=>typeof s=="string")?n:(console.warn("data-dates is not an array of strings"),[])}catch(n){return console.error("Error parsing data-dates",n),[]}}function J(t){return{min:Math.min(...t),max:Math.max(...t)}}function Q(){return new Promise(t=>setTimeout(t,0))}function T(t,i){const n=String(u(t,c.NUMBER_LOCALE,navigator.language||"en-US")),s=Number(String(u(t,c.NUMBER_ROUNDING,0)));return i.toLocaleString(n,{useGrouping:!0,minimumFractionDigits:s,maximumFractionDigits:s})}function ct(t,i,n){if(!t.createSVGPoint||!t.getScreenCTM)throw new Error("Your browser does not support SVG coordinate transformation.");const s=t.getScreenCTM();if(!s)throw new Error("Cannot obtain the screen CTM.");const a=t.createSVGPoint();a.x=i,a.y=n;const e=a.matrixTransform(s);return{x:e.x,y:e.y}}const F={};function tt(t,i,n,s,a){let e=F[s];if(!a){e&&(cancelAnimationFrame(e.frameId),e.frameId=null,e.tool.style.opacity="0");return}const h=i.dataset.type===j.BAR,{x:o,y:O}=ct(t,n.x,h&&!n.isPositive?n.bar.y:n.y);if(!e){const S=document.createElement("div");S.classList.add("tiny-spark-tooltip"),S.setAttribute("id",`tooltip_${s}`),S.setAttribute("role","tooltip"),S.setAttribute("aria-live","polite"),S.style.position="fixed",S.style.pointerEvents="none",S.style.opacity="0",S.style.willChange="top, left",document.body.appendChild(S),e=F[s]={targetX:0,targetY:0,displayX:0,displayY:0,frameId:null,tool:S,width:0,height:0,hasSnapped:!1}}e.tool.setAttribute("aria-hidden","false"),e.tool.innerHTML=`
    <div class="tiny-spark-tooltip-content">
      ${n.d?`${n.d}: `:""}${[null,void 0].includes(n.v)?"-":T(i,Number(n.v))}
    </div>
  `;const{width:w,height:L}=e.tool.getBoundingClientRect();e.width=w,e.height=L;const N=Number(u(i,c.PLOT_RADIUS,3));if(e.targetX=o-e.width/2,e.targetY=O-e.height-N*1.5,!e.hasSnapped){e.displayX=e.targetX,e.displayY=e.targetY,e.tool.style.left=`${e.displayX}px`,e.tool.style.top=`${e.displayY}px`,e.tool.style.opacity="1",e.hasSnapped=!0;return}const b=Number(u(i,c.TOOLTIP_SMOOTHING,1))/10;function _(){e.displayX+=(e.targetX-e.displayX)*b,e.displayY+=(e.targetY-e.displayY)*b,e.tool.style.left=`${Math.round(e.displayX)}px`,e.tool.style.top=`${Math.round(e.displayY)}px`,e.tool.style.opacity="1",e.frameId=requestAnimationFrame(_)}e.frameId==null&&_()}function gt(t){t.innerHTML=""}function pt(t,i){const n=t.dataset.type&&t.dataset.type==="bar";let s=i;gt(t);const{svg:a,svgId:e,width:h,height:o,viewBox:O}=rt(t),{color:w,backgroundColor:L}=dt(t);console.log("dataset = ",t.dataset);const N=Number(t.dataset.padding)??12,b={T:N,R:N,B:N,L:N};console.log("padding = ",b);const _=q(),S=String(u(t,c.SHOW_LAST_VALUE,"false"))==="true",l={left:b.L,top:b.T,width:h-b.L-b.R,height:o-b.T-b.B,bottom:o-b.B,right:h-b.R};console.log("area = ",l);const v=E(t),{min:k}=J(v),V=v.map(r=>[null,void 0].includes(r)?r:r+(k<0?Math.abs(k):0)),{max:et}=J(V);let C=l.width/(v.length-1)===1/0?l.width:l.width/(v.length-1);if(n){const[r,m,p,d]=O.split(" ");a.setAttribute("viewBox",`${Number(r)-C/2} ${m} ${Number(p)+C} ${d}`)}const B=!v.some(r=>r>=0),mt=ut(t),g=V.map((r,m)=>{const p={w:V.length===1?C/2:0,h:V.length===1?l.height/2:0},d=l.left+C*m+p.w,f=(1-(r||0)/et)*l.height+p.h+b.T,H=(1-(k<0?Math.abs(k):0)/et)*l.height+b.T+p.h,W=v[m]>=0;return{y:B&&v.length===1?l.top+l.height/2:f,x:d,v:v[m],d:mt[m]||null,isPositive:W,bar:{x:d-C/2,y:v.length===1?l.top:W?f:B?l.top:H,h:v.length===1?l.height:W?H-f:B&&v.length===0?l.height:isNaN(f-H)?0:f-H,w:C}}}),$=[...g].filter(({v:r})=>![null,void 0].includes(r)),nt=t.getAttribute("data-animation"),A=document.createElementNS(x,"path");A.classList.add("tiny-spark-line-path");const P=document.createElementNS(x,"path");P.classList.add("tiny-spark-line-area"),n||(!t.dataset.curve||t.dataset.curve==="true"?A.setAttribute("d",`M ${K($)}`):A.setAttribute("d",`M ${D($)}`),A.setAttribute("fill","none"),A.setAttribute("stroke",String(u(t,c.LINE_COLOR,w))),A.setAttribute("stroke-width",String(u(t,c.LINE_THICKNESS,2))),A.setAttribute("stroke-linecap","round"),nt==="true"&&s&&(A.style.opacity="0",P.style.opacity="0"),g.length&&(!t.dataset.curve||t.dataset.curve==="true"?P.setAttribute("d",`M ${$[0].x},${l.bottom} ${K($)} L ${$.at(-1).x},${l.bottom} Z`):P.setAttribute("d",`M ${$[0].x},${l.bottom} ${D($)} L ${$.at(-1).x},${l.bottom} Z`)),P.setAttribute("fill",String(u(t,c.AREA_COLOR,"transparent"))),g.length>1&&(a.appendChild(P),a.appendChild(A)));const X=[];g.forEach((r,m)=>{const p=document.createElementNS(x,"line");p.classList.add("tiny-spark-indicator"),p.setAttribute("id",`indicator_${e}_${m}`),p.setAttribute("x1",String(l.left+(g.length===1?l.width/2:m*C))),p.setAttribute("x2",String(l.left+(g.length===1?l.width/2:m*C))),p.setAttribute("y1",String(l.top)),p.setAttribute("y2",String(l.bottom)),p.setAttribute("stroke",String(u(t,c.INDICATOR_COLOR,"#1A1A1A"))),p.setAttribute("stroke-width",String(u(t,c.INDICATOR_WIDTH,"1"))),p.setAttribute("stroke-linecap","round"),p.style.pointerEvents="none",p.style.opacity="0",X.push(p),a.appendChild(p)});let M=[],Y=[];const it=Number(String(u(t,c.PLOT_RADIUS,0)))>0,bt=!String(u(t,c.HIDE_PLOTS_ABOVE,""))||g.length<=Number(String(u(t,c.HIDE_PLOTS_ABOVE,0))),G=it&&bt;n&&g.forEach(({bar:r,v:m},p)=>{if(![null,void 0].includes(m)){const d=document.createElementNS(x,"rect");d.classList.add("tiny-spark-datapoint-bar"),d.setAttribute("x",String(r.x)),d.setAttribute("y",String(r.y)),d.setAttribute("width",String(r.w)),d.setAttribute("height",String(r.h)),d.setAttribute("fill",String(u(t,c.PLOT_COLOR,String(u(t,"lineColor",w))))),d.style.opacity=g.length===1?"1":"0",d.style.transition=`opacity ${p*(1e3*2/g.length)}ms ease-in`,Y.push(d),a.appendChild(d)}}),it&&!n&&g.forEach(({x:r,y:m,v:p},d)=>{if(![null,void 0].includes(p)){const f=document.createElementNS(x,"circle");f.classList.add("tiny-spark-datapoint-circle"),f.classList.add(`circle-${e}`),f.setAttribute("id",`circle_${e}_${d}`),f.setAttribute("cx",String(r||0)),f.setAttribute("cy",String(m||0)),f.setAttribute("r",String(u(t,c.PLOT_RADIUS,3))),f.setAttribute("fill",String(u(t,c.PLOT_COLOR,String(u(t,"lineColor",w))))),f.setAttribute("stroke",L),f.style.opacity=g.length===1?"1":"0",f.style.transition=`opacity ${d*(1e3*2/g.length)}ms ease-in`,f.style.pointerEvents="none",M.push(f),G&&a.appendChild(f)}});let y=null;if(S&&g.length&&g.at(-1)){const r=Number(u(t,c.LAST_VALUE_FONT_SIZE,12));y=document.createElementNS(x,"text"),y.classList.add("tiny-spark-last-value"),y.setAttribute("id",_),n?(y.setAttribute("x",String(g.at(-1).x+Number(u(t,c.LINE_THICKNESS,2)))),y.setAttribute("y",g.at(-1)?.isPositive?String(g.at(-1).y-r/3):String(g.at(-1).bar.y+g.at(-1).bar.h+r)),y.setAttribute("text-anchor","middle")):(y.setAttribute("x",String(g.at(-1).x+6+Number(u(t,c.LINE_THICKNESS,2)))),y.setAttribute("y",String(g.at(-1).y+r/3)),y.setAttribute("text-anchor","start")),y.setAttribute("font-size",String(r)+"px"),y.setAttribute("fill",String(u(t,c.LAST_VALUE_COLOR,String(u(t,c.INDICATOR_COLOR,"#1A1A1A"))))),y.innerHTML=T(t,Number(g.at(-1).v)),y.style.opacity=g.length===1?"1":"0",a.appendChild(y)}g.forEach((r,m)=>{const p=M[m],d=document.createElementNS(x,"rect");d.classList.add("tiny-spark-tooltip-trap"),d.setAttribute("x",`${g.length===1?0:l.left+m*C-C/2}`),d.setAttribute("y",`${l.top}`),d.setAttribute("height",`${l.height}`),d.setAttribute("width",`${C}`),d.setAttribute("fill","transparent"),d.setAttribute("aria-describedby",`tooltip_${e}`),d.addEventListener("mouseenter",()=>{tt(a,t,r,e,!0),G?document.getElementById(`circle_${e}_${m}`)?.setAttribute("r",String(Number(u(t,c.PLOT_RADIUS,3))*1.5)):a.appendChild(p),X[m].style.opacity="1",S&&y&&(m===g.length-1?y.style.opacity="0":y.style.opacity="1")}),d.addEventListener("mouseout",()=>{tt(a,t,r,e,!1),G?document.getElementById(`circle_${e}_${m}`)?.setAttribute("r",String(Number(u(t,c.PLOT_RADIUS,3)))):p.remove(),X.forEach(f=>f.style.opacity="0"),S&&y&&(y.style.opacity="1")}),a.appendChild(d)}),nt==="true"&&s?Q().then(()=>{M.forEach(r=>{r.style.opacity="1"}),Y.forEach(r=>{r.style.opacity="1"}),st(A,1e3,()=>{y&&(y.style.opacity="1")}),at(a,P)}):(M.forEach(r=>{r.style.opacity="1"}),Y.forEach(r=>{r.style.opacity="1"}),y&&(y.style.opacity="1")),t.appendChild(a),t.addEventListener("mouseleave",()=>{const r=F[e];r&&(cancelAnimationFrame(r.frameId),r.frameId=null,r.tool.style.opacity="0",r.hasSnapped=!1)})}function yt(){const t=lt();t.length&&Array.from(t).forEach(i=>{if(!i.dataset.id){const s=q();i.setAttribute("data-id",s)}const n=i;ft(n),n.__renderCount=0,U(n),Q().then(()=>{const s=new ResizeObserver(e=>{e.forEach(()=>U(n))});n.parentElement&&s.observe(n.parentElement),new MutationObserver(e=>{for(const h of e)if(h.type==="attributes"&&h.attributeName&&Object.values(z).includes(h.attributeName)){U(n);break}}).observe(n,{attributes:!0})})})}function U(t){Z(t,"set")&&pt(t,t.__renderCount<2),t.__renderCount+=1}function ft(t){t.dataset.set||console.error(`Tiny-spark exception:

[data-set] data attribute is missing.
Provide an array of numbers, for example:

 data-set="[1, 2, 3]"`)}function ht(t){return JSON.stringify(t)}R.render=yt,R.tinyFormat=ht,Object.defineProperty(R,Symbol.toStringTag,{value:"Module"})});
